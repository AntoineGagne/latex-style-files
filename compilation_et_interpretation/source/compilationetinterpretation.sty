\RequirePackage{iftex}
\RequirePackage{siunitx}
\RequirePackage{mathtools}
\RequirePackage{microtype}
\RequirePackage{xparse}
\RequirePackage{syntax}
\RequirePackage{listings}
\RequirePackage{xcolor}

\ifLuaTeX%
\RequirePackage{fontspec}
\RequirePackage{lualatex-math}
\RequirePackage{luacode}
\setmonofont[
    Contextuals={Alternate}
]{Fira Code}
\makeatletter
\def\verbatim@nolig@list{}
\makeatother
\fi


\sisetup{%
    add-decimal-zero = true,%
    round-mode = places,%
    round-precision = 3%
}%

\DeclareMathOperator{\assign}{\coloneqq}%
\renewcommand{\syntleft}{\itshape}%
\renewcommand{\syntright}{\normalfont}%

\newcommand{\sequence}[1]{%
    \relax\ifmmode\mathtt{#1}\else\texttt{#1}\fi%
}
\newcommand{\regex}[1]{%
    \relax\ifmmode\mathtt{#1}\else\texttt{#1}\fi%
}
\newcommand{\name}[1]{%
    \relax\ifmmode\mathbf{#1}\else\textbf{#1}\fi
}
\newcommand{\regexdefinitionsymbol}[1]{%
    \relax\ifmmode\mathit{#1}\else\textit{#1}\fi%
}
\newcommand{\grammarvalue}[1]{%
    \relax\ifmmode\mathsf{#1}\else\textsf{#1}\fi%
}
\newcommand{\grammarnonterminal}[1]{%
    \relax\ifmmode\mathit{#1}\else\textit{#1}\fi%
}
\newcommand{\grammarsynthesizedattribute}[1]{%
    \relax\ifmmode\mathit{#1}\else\textit{#1}\fi%
}
\newcommand{\grammarinheritedattribute}[1]{%
    \relax\ifmmode\mathit{#1}\else\textit{#1}\fi%
}
\newcommand{\grammarterminal}[1]{%
    \relax\ifmmode\mathbf{#1}\else\textbf{#1}\fi%
}
\newcommand{\syntaxdirectedtranslationstatement}[1]{%
    \relax\ifmmode\mathbf{#1}\else\textbf{#1}\fi%
}
\newcommand{\grammarsingleletterterminal}[1]{%
    \relax\ifmmode\mathtt{#1}\else\texttt{#1}\fi%
}
\DeclareDocumentCommand{\firstset}{o}{%
    \ifmmode\mathrm{FIRST}\IfNoValueTF{#1}{}{\!\paren{#1}}%
    \else FIRST\IfNoValueTF{#1}{}{(#1)}%
    \fi
}
\newcommand{\generatedclass}[1]{%
    \relax\ifmmode\mathsf{#1}\else\textsf{#1}\fi%
}
\newcommand{\generatedor}{%
    \relax\ifmmode\mathtt{||}\else\texttt{||}\fi%
}
\newcommand{\generate}[1]{%
    \relax\ifmmode\mathit{gen}\left(#1\right)\else\textit{gen}(#1)\fi%
}
\newcommand{\conditionalspacing}[2]{%
    \ifmmode#1\else \fi #2\ifmmode#1\else \fi%
}
\DeclareDocumentCommand{\syntaxdirectedtranslationconditional}{m m o}{%
    \syntaxdirectedtranslationstatement{if}\conditionalspacing{\;}{#1}\syntaxdirectedtranslationstatement{then}\conditionalspacing{\;}{#2}\IfNoValueTF{#3}{}{\syntaxdirectedtranslationstatement{else}\conditionalspacing{\;}{#3}}
}
\DeclareDocumentCommand{\nonterminalattribute}{s m m}{%
    #2.\IfBooleanTF{#1}{%
        \grammarinheritedattribute{#3}%
    }{%
        \grammarsynthesizedattribute{#3}%
    }
}
\DeclareDocumentCommand{\predictset}{o}{%
    \ifmmode\mathrm{PREDICT}\IfNoValueTF{#1}{}{\!\paren{#1}}%
    \else PREDICT\IfNoValueTF{#1}{}{(#1)}%
    \fi
}
\DeclareDocumentCommand{\followset}{o}{%
    \ifmmode\mathrm{FOLLOW}\IfNoValueTF{#1}{}{\!\paren{#1}}%
    \else FOLLOW\IfNoValueTF{#1}{}{(#1)}%
    \fi
}

\lstdefinelanguage{generatedcode}{%
    morekeywords={%
        if,%
        goto
    },
    morecomment=[l]{//}%
}
